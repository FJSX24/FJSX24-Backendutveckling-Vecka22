ğŸ§­ Workshop â€“ ğŸš€ Onsdag v22: Enhetstester med Jest
ğŸ“… Datum: 2025-05-28
ğŸ•˜ Tid: 09.00â€“12.00
ğŸ¯ Tema: Enhetstester med Jest (inkl. async, API, mocking)
ğŸ”¬ MÃ¥l: Introduktion, praktisk testning, mentimeter + tydlig progression i svÃ¥righetsgrad

-----------------------------
ğŸ¯ Syfte:

Efter lektionen ska studenterna:
FÃ¶rstÃ¥ syftet med enhetstestning i backend.

Kunna skriva och kÃ¶ra tester med Jest (inkl. async och API).

Kunna testa Express-endpoints med Supertest.

FÃ¶rstÃ¥ grunderna i mocking (jest.fn).

-----------------------------
ğŸ“ Tidsplanering (5 timmar)

| Tid         | Moment                               | InnehÃ¥ll                                                                       |
| ----------- | ------------------------------------ | ------------------------------------------------------------------------------ |
| 09.00â€“09.15 | ğŸ“Š Mentimeter                        | Veckans Menti.                                                                 |
| 09.15â€“09.35 | ğŸ“š PowerPoint & teori (20 min)       | Vad Ã¤r ett enhetstest? VarfÃ¶r testar vi? introduce describe/it/expect()        |
| 09.35â€“10.20 | ğŸ’» Code-Along 1: setup + sync tester | `add(a, b), isEmailValid() â€“ teststruktur & matchers.                          |
| 10.20â€“10.30 | â˜• Kort paus                         | Reflektion i smÃ¥grupp: â€œVarfÃ¶r testa smÃ¥ funktioner separat?â€                  |
| 10.30â€“11.00 | ğŸ’» Code-Along 2: async + Supertest   | `fetchUser()` + test pÃ¥ `GET /api/users` med `supertest`                       |
| 11.00â€“11.30 | ğŸ’¥ Code-Along 3: Mocking & isolering | Skapa `db.js` â†’ `jest.fn()` â†’ kontrollera att funktionen anropas               |
ğŸ§ª Bonusmoment: TesttÃ¤ckning	npx jest --coverage â€“ analysera tÃ¤ckningsrapporter
| 11.30â€“12.00 | ğŸ§ª SjÃ¤lvstÃ¤ndig Ã¶vning (3 nivÃ¥er)    | Uppgifter utifrÃ¥n egna kod eller medfÃ¶ljande mall                              |


-----------------------------
ğŸ§‘â€ğŸ« PowerPoint â€“ InnehÃ¥ll & Talarmanus:

ğŸŸ¦ 1. Vad Ã¤r ett enhetstest?

ğŸ—£ï¸ "Ett enhetstest testar en specifik funktion i isolering â€“ utan att kÃ¶ra resten av applikationen. Till exempel: om du har en add(a, b)-funktion, sÃ¥ testar du bara att den returnerar rÃ¤tt vÃ¤rde â€“ oavsett hur resten av appen ser ut."

ğŸ§  PoÃ¤ngen: Du vill veta: "Funkar den hÃ¤r lilla byggstenen som den ska â€“ helt pÃ¥ egen hand?"

-----------------------------
ğŸŸ¦ 2. VarfÃ¶r testa?

ğŸ—£ï¸ "Det finns tre stora anledningar till att vi skriver tester:"

âœ… FÃ¥ngar buggar tidigt â€“ sÃ¤rskilt nÃ¤r du refaktorerar eller Ã¤ndrar kod.

ğŸ§¾ Dokumentation â€“ dina tester visar vad koden fÃ¶rvÃ¤ntas gÃ¶ra.

ğŸ”„ FÃ¶rtroende vid fÃ¶rÃ¤ndring â€“ du kan Ã¤ndra utan att vara rÃ¤dd att nÃ¥got gÃ¥r sÃ¶nder.

-----------------------------
ğŸŸ¦ 3. Jest: Struktur & begrepp
ğŸ—‚ï¸ Ett grundlÃ¤ggande test ser ut sÃ¥ hÃ¤r:
describe("funktionen add", () => {
  it("ska returnera summan av tvÃ¥ tal", () => {
    expect(add(2, 3)).toBe(5);
  });
});

ğŸ› ï¸ Funktioner i Jest:

Funktion  -  Beskrivning
describe()	-  En grupp av tester, ex. "Alla tester fÃ¶r funktionen add"
it() eller test()	-  SjÃ¤lva testet â€“ formuleras som ett krav
expect()	-  GÃ¶r ett pÃ¥stÃ¥ende om vad funktionen ska returnera

ğŸ¯ Matchers:
.toBe() â€“ exakt lika med (===)

.toEqual() â€“ fungerar fÃ¶r objekt/arrayer

.toContain() â€“ innehÃ¥ller i array eller strÃ¤ng

ğŸ—£ï¸ *"TÃ¤nk sÃ¥ hÃ¤r: expect(result).toBe(expected) = Jag fÃ¶rvÃ¤ntar mig att resultatet ska vara exakt det hÃ¤r."
-----------------------------
ğŸŸ¦ 4. Testa async kod
Du kan testa async funktioner pÃ¥ tre sÃ¤tt:

// 1. Med async/await
it("returnerar data", async () => {
  const data = await fetchData();
  expect(data).toBeDefined();
});

// 2. Med return
it("fungerar med promises", () => {
  return fetchData().then(data => expect(data).toBeDefined());
});

// 3. Med done (mest fÃ¶r callbacks)
it("med done()", done => {
  fetchData(data => {
    expect(data).toBeDefined();
    done();
  });
});

ğŸ—£ï¸ "Viktigt hÃ¤r: Testet mÃ¥ste veta nÃ¤r det Ã¤r klart â€“ annars avslutas det innan resultatet Ã¤r tillbaka."

-----------------------------
ğŸŸ¦ 5. Supertest

ğŸ—£ï¸ "Supertest Ã¤r ett Jest-kompatibelt bibliotek fÃ¶r att testa API-routes i Express. Det fungerar precis som Postman â€“ men direkt i kod."

Exempel:
import request from "supertest";
import app from "../server.js";

it("GET /api/users returnerar 200", async () => {
  const res = await request(app).get("/api/users");
  expect(res.statusCode).toBe(200);
});

"Testar API-endpoints precis som en frontend-anropare skulle gÃ¶ra."
-----------------------------
ğŸŸ¦ 6. Mocking â€“ varfÃ¶r?

ğŸ—£ï¸ "Mocking innebÃ¤r att ersÃ¤tta t.ex. en databasfunktion med en falsk funktion â€“ jest.fn() â€“ sÃ¥ att du kan kontrollera vad som hÃ¤nder utan att behÃ¶va ringa riktiga API:er eller databaser."

const getUsers = jest.fn().mockReturnValue([{ name: "Anna" }]);

"Du vill lÃ¥tsas att databasen ger ett visst svar â€“ sÃ¥ du kan testa din logik oberoende av DB:n."
"Du kontrollerar flÃ¶det och isolerar logik â€“ dÃ¤rfÃ¶r kan du testa snabbare och sÃ¤krare."

-----------------------------
-----------------------------
-----------------------------
ğŸ’» Code-Along: Enhetstestning i backend med Jest

ğŸ“¦ Installation:
npm init -y
npm install supertest express jest

ğŸ“Œ LÃ¤gg till i package.json:
"scripts": {
  "test": "jest",
  "test:watch": "jest --watch"
}

-----------------------------
ğŸ—ƒï¸ Struktur:
projekt/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ math.js              # enklare sync-funktioner (t.ex. add())
â”‚   â”œâ”€â”€ users.js             # async-funktioner, t.ex. fetchUser()
â”‚   â””â”€â”€ db.js                # vÃ¥r databasfunktion (ska mockas)
â”‚   â””â”€â”€ service.js           # anvÃ¤nder db.js
â”œâ”€â”€ __tests__/               # alla tester
â”‚   â”œâ”€â”€ math.test.js         # tester fÃ¶r math.js
â”‚   â”œâ”€â”€ users.test.js        # tester fÃ¶r users.js
â”‚   â””â”€â”€ service.test.js
â”‚   â”œâ”€â”€ api.test.js          # tester fÃ¶r Express API i server.js
â”œâ”€â”€ server.js                # Express-app (fÃ¶r Supertest-Ã¶vningar)
â”œâ”€â”€ package.json

-----------------------------
ğŸ› ï¸ 2. Sync test â€“ src/math.js

src/math.js
genomfÃ¶r den koden

__tests__/math.test.js
genomfÃ¶r den koden

ğŸ§ª KÃ¶r testet:
npm test

-----------------------------
ğŸ” 3. Testa async funktion

ğŸ“„ src/users.js
genomfÃ¶r den koden

ğŸ“„ __tests__/users.test.js
genomfÃ¶r den koden

ğŸ§ª KÃ¶r testet:
npm test
ELLER:
npm run test:watch

-----------------------------
ğŸŒ 4. API-test med Supertest

Skapa en enkel Express-app server.js:
genomfÃ¶r den koden

Test i __tests__/api.test.js:
genomfÃ¶r den koden

ğŸ§ª KÃ¶r testet:
npm test
ELLER:
npm run test:watch

-----------------------------
ğŸŒ 5. Mocking med jest.fn()

ğŸ“¦ Syfte: Testa en funktion som anvÃ¤nder en databasfunktion, utan att faktiskt behÃ¶va kÃ¶ra riktig databaslogik.

ğŸ“„ src/db.js
Denna funktion ska vi mocka i testet.

genomfÃ¶r den koden

ğŸ“„ src/service.js
Den funktion vi ska testa, som internt anvÃ¤nder databasen.

genomfÃ¶r den koden

ğŸ“„ __tests__/service.test.js
HÃ¤r mockar vi getUsersFromDb och testar getUserNames.

genomfÃ¶r den koden

ğŸ§ª KÃ¶r testet:
npm test
ELLER:
npm run test:watch

-----------------------------
ğŸ” Bonusmoment â€“ TesttÃ¤ckning med Jest

ğŸ“¦ MÃ¥l: Analysera hur stor del av projektets kod som faktiskt testas

npx jest --coverage

ğŸ“Š Ger rapport som visar:

Vilka filer testas

Hur stor procentuell andel av kod, rader och grenar tÃ¤cks

Vilken kod som inte kÃ¶rs av dina tester

ğŸ—£ï¸ Talarmanus:
â€œTesttÃ¤ckning Ã¤r ett sÃ¤tt att se vilka delar av koden som faktiskt anvÃ¤nds av dina tester. Det visar svagheter i testningen och vad som riskerar att gÃ¥ sÃ¶nder vid Ã¤ndringar.â€


ğŸ“¦ Syfte: Se hur mycket av koden som faktiskt testas.

ğŸ“„ Vad hÃ¤nder?

Du fÃ¥r en rapport som visar:
% av koden som testas (statements, functions, lines, branches)

Vilka rader i filerna som inte Ã¤r testade

ğŸ§  Exempel pÃ¥ rad som inte testas:
if (process.env.NODE_ENV !== "test") {
  app.listen(3000, () => console.log("Server igÃ¥ng"));
}

ğŸ—£ï¸ Talarmanus:

"HÃ¤r ser vi att vÃ¥r server.js inte har 100% tÃ¤ckning â€“ ofta fÃ¶r att vi har kod som bara kÃ¶rs i produktion eller Ã¤r svÃ¥r att testa. Det Ã¤r okej â€“ men det Ã¤r bra att veta!"
-----------------------------
-----------------------------
-----------------------------
ğŸ§  ReflektionsfrÃ¥gor

Vad gÃ¶r ett test bra?

Ã„r det alltid vÃ¤rt att mocka?

Hur kan du bÃ¶rja skriva tester i ditt Chas Challenge-projekt?

-----------------------------
-----------------------------
-----------------------------
Dags fÃ¶r Ã¶vningar